FROM node:20

WORKDIR /app

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Copy everything (dockerignore handles exclusions)
COPY . .

# Install all dependencies
RUN pnpm install

# Build all workspace packages
RUN pnpm -r --filter './packages/**' run build || true

# Set working directory to frontend
WORKDIR /app/chess-master-frontend

EXPOSE 3000

CMD ["pnpm", "start"]